{
  "version": 3,
  "sources": [
    "src/signal.js"
  ],
  "names": [
    "recursiveMessage",
    "warnOnRecursed",
    "console",
    "warn",
    "throwOnRecursed",
    "Error",
    "createSignal",
    "recursed",
    "installer",
    "smart",
    "emitter",
    "serialEmitter",
    "signal",
    "listeners",
    "emitExecution",
    "isEmitting",
    "Boolean",
    "getEmitExecution",
    "lastEmittedArgs",
    "emit",
    "args",
    "enabledListeners",
    "forEach",
    "listener",
    "isEnabled",
    "push",
    "visitor",
    "iterator",
    "stopped",
    "index",
    "returnValue",
    "start",
    "value",
    "next",
    "done",
    "undefined",
    "result",
    "notify",
    "end",
    "stop",
    "getIndex",
    "getListeners",
    "getArguments",
    "getReturnValue",
    "Object",
    "assign",
    "installed",
    "uninstaller",
    "install",
    "uninstall",
    "disableUntil",
    "disabledListeners",
    "map",
    "disable",
    "someListenerDisabled",
    "length",
    "disabledListener",
    "enable",
    "disableWhileCalling",
    "fn",
    "isListened",
    "createListener",
    "once",
    "removed",
    "disabled",
    "remove",
    "indexOf",
    "splice",
    "freeze",
    "createListenAPI",
    "existingListener",
    "find",
    "listen",
    "listenOnce",
    "createAsyncSignal",
    "options",
    "asyncSerialEmitter"
  ],
  "mappings": "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",
  "sourcesContent": [
    "// https://github.com/dmail-old/notifier/blob/master/index.js\n// https://github.com/cowboy/jquery-throttle-debounce/blob/master/jquery.ba-throttle-debounce.js\n// https://github.com/kriskowal/gtor/blob/master/signals.md\n// https://remysharp.com/2010/07/21/throttling-function-calls\n\nimport { serialEmitter, asyncSerialEmitter, leftToRightCreateIterator } from \"./emitter/index.js\"\n\nconst recursiveMessage = `emit called recursively, its often the sign of an error.\nYou can disable his recursive check doing createSignal({ recursed: null })`\n\nexport const warnOnRecursed = () => console.warn(recursiveMessage)\nexport const throwOnRecursed = () => {\n  throw new Error(recursiveMessage)\n}\n\nexport const createSignal = (\n  { recursed = warnOnRecursed, installer, smart = false, emitter = serialEmitter } = {},\n) => {\n  const signal = {}\n\n  const listeners = []\n  let emitExecution\n  const isEmitting = () => Boolean(emitExecution)\n\n  const getEmitExecution = () => emitExecution\n\n  let lastEmittedArgs\n  const emit = (...args) => {\n    if (isEmitting() && recursed) {\n      recursed({ emitExecution, args })\n    }\n    if (smart) {\n      lastEmittedArgs = args\n    }\n\n    const enabledListeners = []\n    // create a new array in case listeners array gets mutated during emit by listener.remove()\n    // we also push only enabled listener\n    listeners.forEach((listener) => {\n      if (listener.isEnabled()) {\n        enabledListeners.push(listener)\n      }\n    })\n\n    emitExecution = emitter({ listeners: enabledListeners })\n    const {\n      visitor,\n      iterator = leftToRightCreateIterator({ listeners: enabledListeners }),\n    } = emitExecution\n\n    let stopped = false\n    let index = 0\n    let returnValue\n\n    const start = (value) => {\n      returnValue = value\n\n      const next = () => {\n        if (stopped) {\n          return { done: true, value: undefined }\n        }\n\n        const result = iterator.next()\n        if (result.done) {\n          return result\n        }\n        return {\n          done: false,\n          value: () => {\n            const returnValue = result.value.notify(...args)\n            index++\n            return returnValue\n          },\n        }\n      }\n\n      const end = (value) => {\n        returnValue = value\n        emitExecution = undefined\n        return value\n      }\n\n      return { next, end }\n    }\n\n    const stop = () => {\n      stopped = true\n    }\n\n    const getIndex = () => index\n\n    const getListeners = () => enabledListeners\n\n    const getArguments = () => args\n\n    const getReturnValue = () => returnValue\n\n    Object.assign(emitExecution, {\n      stop,\n      getIndex,\n      getListeners,\n      getArguments,\n      getReturnValue,\n    })\n\n    return visitor({ start })\n  }\n\n  let installed = false\n  let uninstaller\n  const install = () => {\n    installed = true\n    if (installer) {\n      uninstaller = installer(signal)\n    }\n  }\n\n  const uninstall = () => {\n    installed = false\n    if (uninstaller) {\n      uninstaller()\n      uninstaller = null\n    }\n  }\n\n  const disableUntil = () => {\n    const disabledListeners = listeners.map((listener) => {\n      listener.disable()\n      return listener\n    })\n    const someListenerDisabled = disabledListeners.length > 0\n    if (installed) {\n      uninstall()\n    }\n\n    return () => {\n      if (someListenerDisabled) {\n        if (installed === false && listeners.length > 0) {\n          install()\n        }\n        disabledListeners.forEach((disabledListener) => {\n          disabledListener.enable()\n        })\n      }\n    }\n  }\n\n  const disableWhileCalling = (fn) => {\n    const enable = disableUntil()\n    fn()\n    enable()\n  }\n\n  const isListened = () => listeners.length > 0\n\n  const createListener = ({ fn, once = false }) => {\n    const listener = {}\n\n    let removed = false\n    let disabled = false\n\n    const remove = () => {\n      if (removed) {\n        return false\n      }\n      removed = true\n\n      const index = listeners.indexOf(listener)\n      // not being inside listeners is normally impossible\n      // if it happens we should throw\n      listeners.splice(index, 1)\n\n      if (listeners.length === 0 && installed) {\n        uninstall()\n      }\n\n      return true\n    }\n\n    const notify = (...args) => {\n      if (once) {\n        remove(\"once\")\n      }\n\n      return fn(...args)\n    }\n\n    const disable = () => {\n      disabled = true\n    }\n\n    const enable = () => {\n      disabled = false\n    }\n\n    const isEnabled = () => disabled === false\n\n    Object.assign(listener, {\n      fn,\n      remove,\n      notify,\n      isEnabled,\n      disable,\n      enable,\n    })\n\n    return Object.freeze(listener)\n  }\n\n  const createListenAPI = (createListener) => (fn) => {\n    const existingListener = listeners.find((listener) => listener.fn === fn)\n    if (existingListener) {\n      throw new Error(`there is already a listener for that fn on this signal`)\n    }\n\n    const listener = createListener(fn)\n    listeners.push(listener)\n    if (installed === false) {\n      install()\n    }\n    if (smart && lastEmittedArgs) {\n      listener.notify(...lastEmittedArgs)\n    }\n\n    return listener\n  }\n\n  const listen = createListenAPI((fn) => createListener({ fn }))\n\n  const listenOnce = createListenAPI((fn) => createListener({ fn, once: true }))\n\n  Object.assign(signal, {\n    isListened,\n    listen,\n    listenOnce,\n    isEmitting,\n    emit,\n    getEmitExecution,\n    disableWhileCalling,\n  })\n\n  return Object.freeze(signal)\n}\n\nexport const createAsyncSignal = (options = {}) =>\n  createSignal({\n    emitter: asyncSerialEmitter,\n    ...options,\n  })\n"
  ]
}